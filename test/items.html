<!DOCTYPE html>
<html>
<head>
  <title>Items — Sniffer Test</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, sans-serif; max-width: 720px; margin: 40px auto; padding: 0 20px; color: #1a1a2e; }
    nav { display: flex; gap: 8px; margin-bottom: 24px; font-size: 13px; }
    nav a { color: #3b82f6; text-decoration: none; padding: 4px 10px; border: 1px solid #e2e8f0; border-radius: 6px; }
    nav a:hover { background: #f0f4ff; }
    nav a.current { background: #3b82f6; color: #fff; border-color: #3b82f6; }
    h2 { margin-bottom: 16px; }
    .categories { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 20px; }
    .categories button {
      padding: 6px 14px; border: 1px solid #ddd; border-radius: 20px;
      background: #fff; cursor: pointer; font-size: 13px; transition: all 0.15s;
    }
    .categories button:hover { background: #f0f0f0; border-color: #aaa; }
    .categories button.active { background: #8b5cf6; color: #fff; border-color: #8b5cf6; }
    .card {
      border: 1px solid #e2e8f0; border-radius: 12px; padding: 20px;
      background: #fff; min-height: 200px;
    }
    .card.loading { opacity: 0.5; }
    .item-list { display: grid; gap: 8px; }
    .item-row {
      display: flex; gap: 12px; align-items: center;
      padding: 10px 14px; background: #fafafa; border-radius: 8px; border: 1px solid #e2e8f0;
    }
    .item-row img { width: 32px; height: 32px; image-rendering: pixelated; }
    .item-row .name { font-weight: 600; text-transform: capitalize; flex: 1; }
    .item-row .cost { color: #888; font-size: 13px; }
    .item-row .effect { font-size: 12px; color: #666; margin-top: 2px; }
    .raw { margin-top: 16px; }
    .raw summary { cursor: pointer; font-size: 13px; color: #888; }
    .raw pre {
      margin-top: 8px; padding: 12px; background: #f8fafc; border-radius: 8px;
      font-size: 11px; max-height: 300px; overflow: auto; white-space: pre-wrap; word-break: break-all;
    }
    .placeholder { color: #aaa; text-align: center; padding: 60px 0; }
  </style>
</head>
<body>
  <nav>
    <a href="../test.html">Home</a>
    <a href="starters.html">Starters</a>
    <a href="legendaries.html">Legendaries</a>
    <a href="berries.html">Berries</a>
    <a href="items.html" class="current">Items</a>
  </nav>

  <h2>Item Categories</h2>
  <div class="categories" id="categories"></div>
  <div class="card" id="card">
    <div class="placeholder">Pick a category to browse items</div>
  </div>

  <script>
    const categories = [
      { id: 1, name: "Stat boosts" },
      { id: 2, name: "Effort drop" },
      { id: 3, name: "Medicine" },
      { id: 4, name: "Other" },
      { id: 5, name: "In a pinch" },
      { id: 12, name: "Standard balls" },
      { id: 13, name: "Special balls" },
      { id: 26, name: "Evolution" },
      { id: 34, name: "Loot" },
    ];

    const catEl = document.getElementById("categories");
    const card = document.getElementById("card");

    categories.forEach(c => {
      const btn = document.createElement("button");
      btn.textContent = c.name;
      btn.onclick = () => loadCategory(c.id, btn);
      catEl.appendChild(btn);
    });

    async function loadCategory(id, btn) {
      catEl.querySelectorAll("button").forEach(b => b.classList.remove("active"));
      if (btn) btn.classList.add("active");
      card.classList.add("loading");
      card.innerHTML = '<div class="placeholder">Loading...</div>';

      const catRes = await fetch(`https://pokeapi.co/api/v2/item-category/${id}`);
      const cat = await catRes.json();

      // Fetch first 8 items for detail
      const itemUrls = cat.items.slice(0, 8);
      const items = await Promise.all(
        itemUrls.map(i => fetch(`https://pokeapi.co/api/v2/item/${i.name}`).then(r => r.json()))
      );

      card.classList.remove("loading");

      card.innerHTML = `
        <div class="item-list">
          ${items.map(i => {
            const effect = i.effect_entries?.find(e => e.language.name === "en")?.short_effect || "";
            const sprite = i.sprites?.default || "";
            return `
              <div class="item-row">
                ${sprite ? `<img src="${sprite}" alt="${i.name}">` : '<div style="width:32px"></div>'}
                <div style="flex:1">
                  <div class="name">${i.name.replace(/-/g, " ")}</div>
                  ${effect ? `<div class="effect">${effect}</div>` : ""}
                </div>
                <div class="cost">${i.cost ? `₽${i.cost}` : "—"}</div>
              </div>`;
          }).join("")}
        </div>
        <details class="raw"><summary>Raw category response</summary><pre>${JSON.stringify(cat, null, 2)}</pre></details>
      `;
    }
  </script>
</body>
</html>
