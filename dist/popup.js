import"./chunks/modulepreload-polyfill-B5Qt9EMX.js";function Se(e){return e?e>=200&&e<300?"ok":e>=300&&e<400?"redir":"err":""}function ce(e){try{const t=new URL(e);return t.pathname+t.search}catch{return e}}function we(e){try{return new URL(e).pathname}catch{return e}}function Me(e){return!e||e.startsWith("{")||e.startsWith("[")?!1:e.includes("=")&&!e.includes(`
`)}function le(e){if(!e)return"—";const t=e.length;return t<1e3?`${t}B`:t<1e6?`${(t/1e3).toFixed(1)}K`:`${(t/1e6).toFixed(1)}M`}function Re(e){const t=Math.floor((Date.now()-e)/1e3);return t<60?"just now":t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:`${Math.floor(t/86400)}d ago`}function u(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function he(e,t){let n="";for(const[a,s]of t)n+=(n?"&":"?")+encodeURIComponent(a)+"="+s;return e+n}let S=null,$e=null;function Ee(e){ue(),S=document.createElement("div"),S.popover="manual",S.className="hint-popover",S.textContent=e.dataset.hint;const t=`--hint-${Date.now()}`;S.style.positionAnchor=t,e.style.anchorName=t,document.body.appendChild(S),S.showPopover()}function ue(){clearTimeout($e),S&&(S.hidePopover(),S.remove(),S=null)}document.addEventListener("mouseenter",e=>{const t=e.target.closest("[data-hint]");!t||!t.dataset.hint||($e=setTimeout(()=>Ee(t),1400))},!0);document.addEventListener("mouseleave",e=>{e.target.closest("[data-hint]")&&ue()},!0);document.addEventListener("click",e=>{const t=e.target.closest("[data-hint-click]");t?.dataset.hint&&(ue(),Ee(t))},!0);const xe=document.getElementById("mainView"),T=document.getElementById("detailView"),G=document.getElementById("record"),Ie=document.getElementById("filters"),ke=document.getElementById("ignoreBar"),D=document.getElementById("originGroups"),Ce=document.getElementById("recCount"),pe=document.getElementById("recSearchInput"),K=document.getElementById("recordings"),qe=document.getElementById("backBtn"),me=document.getElementById("detailCount"),ge=document.getElementById("detailPathFilter"),ye=document.getElementById("detailBodyFilter"),C=document.getElementById("detailEntries"),X=document.getElementById("detailRecordBtn"),Z=document.getElementById("detailReplayBtn"),F=document.getElementById("detailSortBtn"),oe=document.getElementById("detailOriginGroups"),Be=["xhr","fetch","script","css","img","font","doc","other"];let M=["xhr","fetch"],z=[],E=[],ee=[],ne="main",g=null,H=-1,Q=!1,be="",k=null,R=null,q=!1,Y=null;function Te(e){if(!e)return"";if(Me(e)){const t=new URLSearchParams(e),n=[...t.entries()].sort((a,s)=>(s[1]?1:0)-(a[1]?1:0)).map(([a,s])=>`<div class="payload-field">
            <label>${u(a)}
              <input name="payload-field" data-key="${u(a)}" value="${u(s)}">
            </label>
          </div>`).join("");return`<div class="payload-section collapsed">
      <div class="payload-header">
        <span class="payload-toggle">Payload (${t.size} params)</span>
        <button class="payload-mode" data-mode="parsed">Raw</button>
      </div>
      <div class="payload-body">
        <div class="payload-parsed">${n}</div>
        <textarea class="payload-raw" name="payload" style="display:none">${u(e)}</textarea>
      </div>
    </div>`}return`<label>Request payload
    <textarea name="payload">${u(e)}</textarea>
  </label>`}function Pe(e){const t=e.querySelector(".payload-section");if(t){const a=t.querySelector(".payload-raw");if(a&&a.style.display!=="none")return a.value;const s=t.querySelectorAll('[name="payload-field"]');if(s.length>0){const i=new URLSearchParams;return s.forEach(r=>i.set(r.dataset.key,r.value)),i.toString()}}const n=e.querySelector('[name="payload"]');return n?n.value:null}function Ne(e){return e.map(t=>`<span class="ignore-tag" data-pattern="${u(t)}">${u(t)} <span class="remove">x</span></span>`).join("")}function fe(){Ie.innerHTML=Be.map(e=>`<span class="chip ${M.includes(e)?"on":""}" data-type="${e}">${e}</span>`).join("")}Ie.addEventListener("click",e=>{const t=e.target.closest(".chip");if(!t)return;const n=t.dataset.type;M.includes(n)?M=M.filter(a=>a!==n):M.push(n),fe(),chrome.runtime.sendMessage({type:"setFilters",filters:M})});function ae(){ke.innerHTML=Ne(z)+'<input id="ignoreInput" placeholder="Ignore pattern... (Enter to add)">',document.getElementById("ignoreInput").addEventListener("keydown",e=>{if(e.key!=="Enter")return;const t=e.target.value.trim();t&&(e.target.value="",chrome.runtime.sendMessage({type:"addIgnore",pattern:t},n=>{n?.ignorePatterns&&(z=n.ignorePatterns),ae()}))})}ke.addEventListener("click",e=>{const t=e.target.closest(".remove");if(!t)return;const n=t.closest(".ignore-tag")?.dataset.pattern;n&&chrome.runtime.sendMessage({type:"removeIgnore",pattern:n},a=>{a?.ignorePatterns&&(z=a.ignorePatterns),ae()})});const V=new Set;function U(){const e="knownOriginsList",t=`<datalist id="${e}">${ee.map(n=>`<option value="${u(n)}">`).join("")}</datalist>`;if(E.length===0){D.innerHTML=t+'<button class="origin-groups-add">+ Origin group</button>';return}D.innerHTML=t+E.map(n=>{const a=V.has(n.id),s=(n.mappings||[]).length,i=a?"v":">",r=!a&&s>0?`<span class="origin-group-summary">${s} mapping${s>1?"s":""}</span>`:"";let o="";return a&&(o=(n.mappings||[]).map((m,h)=>`<div class="origin-mapping" data-gid="${u(n.id)}" data-mi="${h}"><input class="origin-mapping-left" value="${u(m[0]||"")}" placeholder="https://..." list="${e}"><span class="origin-mapping-arrow">↔</span><input class="origin-mapping-right" value="${u(m[1]||"")}" placeholder="https://..." list="${e}"><span class="origin-mapping-del">x</span></div>`).join("")+`<button class="origin-mapping-add" data-id="${u(n.id)}">+ mapping</button>`),`<div class="origin-group" data-id="${u(n.id)}"><div class="origin-group-header"><span class="origin-group-toggle" data-id="${u(n.id)}">${i}</span><input class="origin-group-name" value="${u(n.name)}" placeholder="Group name..." data-id="${u(n.id)}">`+r+`<span class="del-group" data-id="${u(n.id)}">x</span></div>`+o+"</div>"}).join("")+'<button class="origin-groups-add">+ Origin group</button>'}function A(){chrome.runtime.sendMessage({type:"setOriginGroups",groups:E},e=>{e?.originGroups&&(E=e.originGroups)})}D.addEventListener("click",e=>{if(e.target.closest(".origin-group-toggle")){const n=e.target.closest(".origin-group-toggle").dataset.id;V.has(n)?V.delete(n):V.add(n),U();return}if(e.target.closest(".origin-groups-add")){const n="g"+Date.now();E=[...E,{id:n,name:"",mappings:[]}],V.add(n),U(),A();const a=D.querySelector(`.origin-group-name[data-id="${n}"]`);a&&a.focus();return}if(e.target.closest(".origin-mapping-add")){const n=e.target.closest(".origin-mapping-add").dataset.id;E=E.map(s=>s.id===n?{...s,mappings:[...s.mappings||[],["",""]]}:s),U(),A();const a=D.querySelector(`.origin-group[data-id="${n}"] .origin-mapping:last-of-type .origin-mapping-left`);a&&a.focus();return}if(e.target.closest(".origin-mapping-del")){const n=e.target.closest(".origin-mapping"),a=n.dataset.gid,s=parseInt(n.dataset.mi,10);E=E.map(i=>i.id===a?{...i,mappings:i.mappings.filter((r,o)=>o!==s)}:i),U(),A();return}const t=e.target.closest(".del-group");if(t){const n=t.dataset.id;E=E.filter(a=>a.id!==n),U(),A();return}});D.addEventListener("change",e=>{const t=e.target.closest(".origin-group-name");if(t){const s=t.dataset.id,i=t.value.trim();E=E.map(r=>r.id===s?{...r,name:i}:r),A();return}const n=e.target.closest(".origin-mapping-left"),a=e.target.closest(".origin-mapping-right");if(n||a){const s=e.target.closest(".origin-mapping"),i=s.dataset.gid,r=parseInt(s.dataset.mi,10);E=E.map(o=>{if(o.id!==i)return o;const c=o.mappings.map((m,h)=>{if(h!==r)return m;const l=[...m];return n&&(l[0]=n.value.trim()),a&&(l[1]=a.value.trim()),l});return{...o,mappings:c}}),A();return}});function Ue(e,t,n){Ce.textContent=e.length?`(${e.length})`:"";const a=(pe.value||"").trim().toLowerCase(),s=a?e.filter(c=>(c.name||"").toLowerCase().includes(a)):e;if(s.length===0){K.innerHTML=a?'<div class="empty" style="padding:16px">No matches</div>':'<div class="empty" style="padding:16px">No recordings yet</div>';return}const{recording:i,recordTargetId:r,recordCount:o}=n||{};K.innerHTML=s.toReversed().map(c=>{const m=c.id in(t||{}),h=i&&r===c.id;let l="";if(c.sourceUrl)try{const d=new URL(c.sourceUrl);l=`<span class="rec-source" data-url="${u(c.sourceUrl)}" title="${u(c.sourceUrl)}">${u(d.pathname+d.search)}</span>`}catch{}const v=h?`<span class="rec-recording-badge">REC ${o}</span>`:"";return`
    <div class="rec-item${h?" rec-active-recording":""}" data-id="${c.id}">
      <span class="rec-name" data-id="${c.id}">${u(c.name)}</span>
      ${v}
      ${l}
      <span class="rec-meta">${c.count}${h?`+${o}`:""} req - ${Re(c.timestamp)}</span>
      <button class="merge" data-id="${c.id}">Merge</button>
      <button class="replay ${m?"active-replay":""}" data-id="${c.id}">
        ${m?"Stop":"Replay"}
      </button>
      <button class="del" data-id="${c.id}">x</button>
    </div>`}).join("")}pe.addEventListener("input",()=>B());function B(){ne==="main"&&chrome.runtime.sendMessage({type:"getState"},e=>{if(!e)return;M=e.recordFilters||M,fe(),JSON.stringify(z)!==JSON.stringify(e.ignorePatterns||[])&&(z=e.ignorePatterns||[],ae());const t=e.knownOrigins||[],n=JSON.stringify(E)!==JSON.stringify(e.originGroups||[]),a=JSON.stringify(ee)!==JSON.stringify(t);if((n||a)&&(E=e.originGroups||[],ee=t,U()),G.classList.remove("recording"),e.recording?(G.classList.add("recording"),G.textContent=`Stop (${e.recordEntries.length})`):G.textContent="Record",!Q){const s={recording:e.recording,recordTargetId:e.recordTargetId,recordCount:(e.recordEntries||[]).length},i=JSON.stringify(e.recordings.map(r=>r.id+r.name+r.count+(r.sourceUrl||"")))+JSON.stringify(e.activeReplays||{})+(pe.value||"")+(e.recording?e.recordTargetId+s.recordCount:"");i!==be&&(be=i,Ue(e.recordings,e.activeReplays,s))}})}G.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"getState"},e=>{e&&(e.recording?chrome.runtime.sendMessage({type:"stopRecordInto",recordingId:e.recordTargetId},()=>B()):chrome.runtime.sendMessage({type:"createAndRecord",filters:M},t=>{t?.recordingId&&ve(t.recordingId)}))})});K.addEventListener("click",e=>{const t=e.target.closest(".rec-source");if(t){const i=t.dataset.url;i&&chrome.tabs.query({active:!0,currentWindow:!0},r=>{r[0]?.id&&chrome.tabs.update(r[0].id,{url:i})});return}const n=e.target.closest(".rec-name");if(n&&!e.target.closest("button")){ve(n.dataset.id);return}const a=e.target.closest("button");if(!a)return;const s=a.dataset.id;if(a.classList.contains("replay")&&(a.classList.contains("active-replay")?chrome.runtime.sendMessage({type:"stopReplay",recordingId:s},()=>B()):chrome.runtime.sendMessage({type:"startReplay",recordingId:s},()=>B())),a.classList.contains("merge")){Oe(s);return}a.classList.contains("del")&&chrome.runtime.sendMessage({type:"deleteRecording",recordingId:s},()=>B())});function Oe(e){const t=K.querySelector(`.rec-item[data-id="${e}"]`);if(!t)return;const n=K.querySelector(".merge-picker");n&&(n.remove(),Q=!1),chrome.runtime.sendMessage({type:"getState"},a=>{if(!a)return;const s=a.recordings.filter(c=>c.id!==e);if(s.length===0)return;Q=!0;const i=document.createElement("div");i.className="merge-picker",i.innerHTML='<span class="merge-label">Merge into:</span>'+s.map(c=>`<button class="merge-target" data-id="${c.id}">${u(c.name)}</button>`).join("")+'<button class="merge-cancel">Esc</button>',t.after(i);const r=()=>{i.remove(),Q=!1,document.removeEventListener("keydown",o)};i.addEventListener("click",c=>{const m=c.target.closest(".merge-target");if(m){chrome.runtime.sendMessage({type:"mergeRecording",sourceId:e,targetId:m.dataset.id},()=>{r(),B()});return}c.target.closest(".merge-cancel")&&r()});const o=c=>{c.key==="Escape"&&r()};document.addEventListener("keydown",o)})}function ve(e){g=e,H=-1,q=!1,ge.value="",ye.value="",ne="detail",xe.style.display="none",T.style.display="block",$()}function He(){k&&(k.destroy(),k=null),ne="main",T.style.display="none",xe.style.display="block",B()}function Le(){He()}function re(){chrome.runtime.sendMessage({type:"getState"},e=>{if(!e)return;const t=g in(e.activeReplays||{});Z.textContent=t?"Stop":"Replay",Z.classList.toggle("active-replay",t);const n=e.recording&&e.recordTargetId===g;X.textContent=n?`Stop (${e.recordEntries.length})`:"Record",X.classList.toggle("recording",n);const s=(e.recordings||[]).filter(i=>i.id!==g).length===0;J.classList.toggle("btn-disabled",s),J.dataset.hint=s?"No other recordings to import from":"",J.toggleAttribute("data-hint-click",s)})}let N=[],w=[],te=!1;function de(){if(E.length===0){oe.innerHTML="";return}const e=E.map(s=>`<span class="detail-og-chip${w.includes(s.id)?" on":""}" data-id="${u(s.id)}">${u(s.name||s.id)}</span>`).join(""),t=E.filter(s=>w.includes(s.id)),n=t.some(s=>(s.mappings||[]).length>0);let a="";n&&(a+=`<span class="detail-og-expand">${te?"v":">"} mappings</span>`,te&&(a+=`<div class="detail-og-mappings">${t.flatMap(i=>(i.mappings||[]).map(r=>`<div class="detail-og-mapping"><span>${u(r[0]||"")}</span> <span class="origin-mapping-arrow">↔</span> <span>${u(r[1]||"")}</span></div>`)).join("")}</div>`)),oe.innerHTML=e+a}oe.addEventListener("click",e=>{if(e.target.closest(".detail-og-expand")){te=!te,de();return}const t=e.target.closest(".detail-og-chip");if(!t)return;const n=t.dataset.id;w.includes(n)?w=w.filter(a=>a!==n):w=[...w,n],de(),chrome.runtime.sendMessage({type:"setRecordingOriginGroups",recordingId:g,groupIds:w})});function $(){chrome.runtime.sendMessage({type:"getRecording",recordingId:g},e=>{if(!e){Le();return}const t=T.querySelector("#detailTitle");if(t)t.textContent=e.name,t.title="Click to rename";else{const i=document.createElement("span");i.id="detailTitle",i.style.cssText="flex:1; font-size:12px; cursor:pointer",i.title="Click to rename",i.textContent=e.name;const o=T.querySelector(".toolbar").querySelector(".rename-input");o&&o.replaceWith(i)}R=e.sort||null,F.classList.toggle("active",!!R),F.textContent=R?"Sort: URL":"Sort";const n=document.getElementById("detailMeta");let a="";if(e.sourceUrl)try{const i=new URL(e.sourceUrl);a=`<div class="detail-source"><a href="${u(e.sourceUrl)}" target="_blank" title="${u(e.sourceUrl)}">Captured on ${u(i.host+i.pathname)}</a> <span class="detail-source-edit" title="Edit URL">edit</span></div>`}catch{}a||(a='<div class="detail-source"><span class="detail-source-edit" title="Set source URL">+ Add source URL</span></div>'),n.innerHTML=`<textarea class="detail-desc" rows="1" placeholder="Add description...">${u(e.description||"")}</textarea>${a}`;const s=n.querySelector(".detail-desc");s.addEventListener("blur",()=>{chrome.runtime.sendMessage({type:"updateRecording",recordingId:g,updates:{description:s.value}})}),n.querySelector(".detail-source-edit")?.addEventListener("click",()=>{const i=n.querySelector(".detail-source"),r=document.createElement("input");r.className="detail-source-input",r.value=e.sourceUrl||"",r.placeholder="https://...",i.replaceChildren(r),r.focus(),r.addEventListener("blur",()=>{const o=r.value.trim();chrome.runtime.sendMessage({type:"updateRecording",recordingId:g,updates:{sourceUrl:o||null}},()=>$())}),r.addEventListener("keydown",o=>{o.key==="Enter"&&r.blur(),o.key==="Escape"&&$()})}),w=e.originGroupIds||[],chrome.runtime.sendMessage({type:"getState"},i=>{let r=e.entries;i?.recording&&i.recordTargetId===g&&(r=[...e.entries,...i.recordEntries]),i&&(E=i.originGroups||[],ee=i.knownOrigins||[]),me.textContent=`${r.length} req`,N=r,r.some(o=>o.disabled)&&(q=!0),O(),re(),de()})})}function Ae(){chrome.runtime.sendMessage({type:"getState"},e=>{!e?.recording||e.recordTargetId!==g||chrome.runtime.sendMessage({type:"getRecording",recordingId:g},t=>{if(!t)return;const n=[...t.entries,...e.recordEntries];n.length!==N.length&&(N=n,me.textContent=`${n.length} req`,O())})})}function O(){const e=ge.value.trim().toLowerCase(),t=ye.value.trim().toLowerCase();let n=N;(e||t)&&(n=n.filter(a=>!(e&&!a.url.toLowerCase().includes(e)||t&&!(a.body||"").toLowerCase().includes(t)))),R==="url"&&(n=[...n].sort((a,s)=>a.url.localeCompare(s.url,void 0,{numeric:!0}))),De(n)}ge.addEventListener("input",O);ye.addEventListener("input",O);F.addEventListener("click",()=>{R=R?null:"url",F.classList.toggle("active",!!R),F.textContent=R?"Sort: URL":"Sort",chrome.runtime.sendMessage({type:"updateRecording",recordingId:g,updates:{sort:R}}),O()});T.querySelector(".detail-toggle-all").addEventListener("change",e=>{if(N.length>0&&N.every(n=>!n.disabled)&&!q){q=!0,e.target.checked=!0,e.target.indeterminate=!0,O();return}e.target.checked?(q=!1,chrome.runtime.sendMessage({type:"toggleAllEntries",recordingId:g,disabled:!1},()=>$())):chrome.runtime.sendMessage({type:"toggleAllEntries",recordingId:g,disabled:!0},()=>$())});function De(e){if(e.length===0){C.innerHTML='<div class="empty">No entries in this recording</div>';return}const t=T.querySelector(".detail-toggle-all"),n=e.length>0&&e.every(r=>!r.disabled),a=e.some(r=>!r.disabled);t&&(t.checked=n,t.indeterminate=a&&!n||n&&q);const s=!n||q;C.innerHTML=e.map((r,o)=>{const c=!r.disabled,m=`
      <div class="detail-row${s?"":" no-toggle"}" data-index="${o}">
        ${s?`<input type="checkbox" class="detail-entry-toggle" data-index="${o}" ${c?"checked":""} title="Shift+click to solo">`:""}
        <span class="method ${r.method}">${r.method}</span>
        <span class="type">${r.kind||""}</span>
        <span class="url" title="${u(r.url)}">${u(ce(r.url))}</span>
        <span class="size">${le(r.body)}</span>
        <span class="status ${Se(r.status)}">${r.status||"..."}</span>
        <span class="detail-del" data-index="${o}">x</span>
      </div>`;if(o===H){const h=`
        <div class="edit-form" data-index="${o}">
          <div class="url-section">
            <div class="url-header">
              <label>URL</label>
              <button class="url-mode" type="button">Parsed</button>
            </div>
            <div class="url-raw">
              <input name="url" value="${u(r.url)}">
            </div>
            <div class="url-parsed" style="display:none">
              ${(()=>{try{const l=new URL(r.url),v=[...l.searchParams.entries()];return`<input name="url-base" value="${u(l.origin+l.pathname)}">`+(v.length?`<div class="payload-parsed" style="margin-top:4px">${v.map(([d,p])=>`<div class="payload-field"><label>${u(d)}<input name="url-param" data-key="${u(d)}" value="${u(p)}"></label></div>`).join("")}</div>`:"")}catch{return`<input name="url-base" value="${u(r.url)}">`}})()}
            </div>
          </div>
          <div class="edit-row">
            <label>Method
              <select name="method">
                ${["GET","POST","PUT","PATCH","DELETE","HEAD","OPTIONS"].map(l=>`<option ${l===r.method?"selected":""}>${l}</option>`).join("")}
              </select>
            </label>
            <label>Status
              <input name="status" type="number" value="${r.status||200}">
            </label>
            <label>Kind
              <input name="kind" value="${u(r.kind||"")}">
            </label>
            <label>Delay ms
              <input name="delay" type="number" min="0" value="${r.delay||0}">
            </label>
          </div>
          ${Te(r.payload)}
          <div class="edit-actions">
            <button class="save" data-index="${o}">Save</button>
            <button class="cancel">Cancel</button>
          </div>
          <label>Response body</label>
          ${(()=>{const l=r.bodyVariants;if(l&&l.length>0){const v=r.activeVariant||0;return`<div class="variant-bar" data-index="${o}">
                ${l.map((d,p)=>`<span class="variant-tab ${p===v?"active":""}" data-vi="${p}">${u(d.name)}${p===v?`<span class="variant-edit" data-vi="${p}">edit</span>${l.length>1?`<span class="variant-del" data-vi="${p}">x</span>`:""}`:""}</span>`).join("")}
                <button class="variant-add" data-index="${o}">+</button>
                <button class="variant-pick" data-index="${o}">Copy from...</button>
              </div>`}return`<div class="variant-bar" data-index="${o}">
              <button class="variant-add" data-index="${o}">+</button>
              <button class="variant-pick" data-index="${o}">Copy from...</button>
            </div>`})()}
          <div class="jsoneditor-container" data-index="${o}"></div>
        </div>`;return`<div class="detail-entry expanded${r.disabled?" disabled":""}">${m}${h}</div>`}return`<div class="detail-entry${r.disabled?" disabled":""}">${m}</div>`}).join(""),k&&(k.destroy(),k=null);const i=C.querySelector(".jsoneditor-container");if(i){const r=parseInt(i.dataset.index),o=e[r]?.body||"";let c;try{c=JSON.parse(o)}catch{}if(c!==void 0){const m=document.createElement("div");i.appendChild(m),k=new JSONEditor(m,{mode:"tree",modes:["tree","text"],navigationBar:!1}),k.set(c)}else{const m=document.createElement("textarea");m.name="body",m.textContent=o,i.replaceWith(m)}}if(Y){const{entryIndex:r,variantIndex:o}=Y;Y=null;const c=C.querySelector(`.variant-bar[data-index="${r}"] .variant-tab[data-vi="${o}"] .variant-edit`);c&&c.click()}}qe.addEventListener("click",Le);X.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"getState"},e=>{e&&(e.recording?chrome.runtime.sendMessage({type:"stopRecordInto",recordingId:g},()=>$()):chrome.runtime.sendMessage({type:"startRecord",filters:e.recordFilters,targetId:g},()=>re()))})});Z.addEventListener("click",()=>{const t=Z.classList.contains("active-replay")?"stopReplay":"startReplay";chrome.runtime.sendMessage({type:t,recordingId:g},()=>re())});const J=document.getElementById("importBtn"),se=document.getElementById("dedupeBtn");se.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"getRecording",recordingId:g},e=>{const t=e?e.entries.length:0;chrome.runtime.sendMessage({type:"dedupeEntries",recordingId:g},()=>{chrome.runtime.sendMessage({type:"getRecording",recordingId:g},n=>{const a=n?n.entries.length:t,s=t-a,i=document.createElement("span");i.textContent=s>0?`−${s}`:"✓",i.className="ghost-float",se.style.position="relative",se.appendChild(i),$()})})})});J.addEventListener("click",()=>{if(J.classList.contains("btn-disabled"))return;const e=T.querySelector(".import-picker");if(e){e.remove();return}je()});function je(){chrome.runtime.sendMessage({type:"getState"},e=>{if(!e)return;const t=e.recordings.filter(m=>m.id!==g);if(t.length===0)return;const n=document.createElement("div");n.className="import-picker";const a=document.createElement("div");a.className="import-picker-header",a.innerHTML='<span class="merge-label">Import from:</span>'+t.map(m=>`<button class="import-source" data-id="${m.id}">${u(m.name)}</button>`).join("")+'<button class="merge-cancel">Close</button>',n.appendChild(a);const s=document.createElement("div");s.className="import-entries",n.appendChild(s),T.querySelector(".toolbar").after(n);const r=()=>{n.remove(),document.removeEventListener("keydown",c),$()},o=m=>{a.querySelectorAll(".import-source").forEach(h=>h.classList.toggle("active",h.dataset.id===m)),chrome.runtime.sendMessage({type:"getRecording",recordingId:m},h=>{if(!h){s.innerHTML="";return}s.innerHTML=h.entries.map((l,v)=>`<div class="import-row" data-index="${v}">
              <span class="method ${l.method}">${l.method}</span>
              <span class="type">${l.kind||""}</span>
              <span class="url" title="${u(l.url)}">${u(ce(l.url))}</span>
              <span class="size">${le(l.body)}</span>
              <button class="import-add" data-index="${v}">Add</button>
            </div>`).join("")||'<div class="empty">No entries</div>',s.onclick=l=>{const v=l.target.closest(".import-add");if(!v||v.classList.contains("import-added"))return;const d=parseInt(v.dataset.index),p=h.entries[d];p&&chrome.runtime.sendMessage({type:"copyEntries",targetId:g,entries:[p]},()=>{v.textContent="Added",v.classList.add("import-added"),chrome.runtime.sendMessage({type:"getRecording",recordingId:g},y=>{y&&(N=y.entries,me.textContent=`${y.entries.length} req`,O())})})}})};a.addEventListener("click",m=>{const h=m.target.closest(".import-source");if(h){o(h.dataset.id);return}m.target.closest(".merge-cancel")&&r()});const c=m=>{m.key==="Escape"&&r()};document.addEventListener("keydown",c)})}function Ge(e){const t=C.querySelector(".variant-picker");if(t){t.remove();return}chrome.runtime.sendMessage({type:"getState"},n=>{if(!n)return;const a=document.createElement("div");a.className="variant-picker";const s=document.createElement("div");s.className="variant-picker-header";const i=n.recordings.filter(l=>l.id!==g);s.innerHTML=`<span class="merge-label">Copy body from:</span><button class="variant-picker-source active" data-id="${g}">This recording</button>`+i.map(l=>`<button class="variant-picker-source" data-id="${l.id}">${u(l.name)}</button>`).join("")+'<button class="merge-cancel">Close</button>',a.appendChild(s);const r=document.createElement("div");r.className="variant-picker-entries",a.appendChild(r);const o=C.querySelector(`.variant-bar[data-index="${e}"]`);o&&o.after(a);const c=()=>{a.remove(),document.removeEventListener("keydown",h)},m=l=>{s.querySelectorAll(".variant-picker-source").forEach(v=>v.classList.toggle("active",v.dataset.id===l)),chrome.runtime.sendMessage({type:"getRecording",recordingId:l},v=>{if(!v){r.innerHTML="";return}const d=l===g,p=v.entries.map((y,b)=>d&&b===e?"":`<div class="variant-picker-row" data-index="${b}">
                <span class="method ${y.method}">${y.method}</span>
                <span class="type">${y.kind||""}</span>
                <span class="url" title="${u(y.url)}">${u(ce(y.url))}</span>
                <span class="size">${le(y.body)}</span>
                <button class="variant-picker-add" data-index="${b}">Copy</button>
              </div>`).filter(Boolean).join("");r.innerHTML=p||'<div class="empty">No entries</div>',r.onclick=y=>{const b=y.target.closest(".variant-picker-add");if(!b)return;const x=parseInt(b.dataset.index),f=v.entries[x];if(!f)return;const P=we(f.url).split("/").filter(Boolean).pop()||"imported";c(),chrome.runtime.sendMessage({type:"addVariant",recordingId:g,index:e,name:P,body:f.body||""},()=>{chrome.runtime.sendMessage({type:"getRecording",recordingId:g},L=>{if(!L)return;const j=L.entries[e];j?.bodyVariants&&(Y={entryIndex:e,variantIndex:j.bodyVariants.length-1}),$()})})}})};s.addEventListener("click",l=>{const v=l.target.closest(".variant-picker-source");if(v){m(v.dataset.id);return}l.target.closest(".merge-cancel")&&c()});const h=l=>{l.key==="Escape"&&c()};document.addEventListener("keydown",h),m(g)})}T.addEventListener("click",e=>{const t=e.target.closest("#detailTitle");if(!t)return;const n=t.textContent,a=document.createElement("input");a.className="rename-input",a.value=n,a.style.flex="1",a.style.fontSize="12px",t.replaceWith(a),a.focus(),a.select();const s=()=>{const i=a.value.trim()||n;chrome.runtime.sendMessage({type:"renameRecording",recordingId:g,name:i},()=>$())};a.addEventListener("keydown",i=>{i.key==="Enter"&&s(),i.key==="Escape"&&$()}),a.addEventListener("blur",s)});C.addEventListener("click",e=>{const t=e.target.closest(".url-mode");if(t){const d=t.closest(".url-section"),p=d.querySelector(".url-raw"),y=d.querySelector(".url-parsed");if(p.style.display!=="none"){const b=p.querySelector('[name="url"]').value;try{const x=new URL(b);y.querySelector('[name="url-base"]').value=x.origin+x.pathname,y.querySelectorAll('[name="url-param"]').forEach(I=>{x.searchParams.has(I.dataset.key)&&(I.value=x.searchParams.get(I.dataset.key))})}catch{}p.style.display="none",y.style.display="",t.textContent="Raw"}else{const b=y.querySelector('[name="url-base"]').value,f=[...y.querySelectorAll('[name="url-param"]')].map(I=>[I.dataset.key,I.value]);p.querySelector('[name="url"]').value=he(b,f),y.style.display="none",p.style.display="",t.textContent="Parsed"}return}const n=e.target.closest(".payload-toggle");if(n){n.closest(".payload-section").classList.toggle("collapsed");return}const a=e.target.closest(".payload-mode");if(a){const d=a.closest(".payload-section"),p=d.querySelector(".payload-parsed"),y=d.querySelector(".payload-raw");if(a.dataset.mode==="parsed"){const b=p.querySelectorAll('[name="payload-field"]'),x=new URLSearchParams;b.forEach(f=>x.set(f.dataset.key,f.value)),y.value=x.toString(),p.style.display="none",y.style.display="",a.dataset.mode="raw",a.textContent="Parsed"}else{try{const b=new URLSearchParams(y.value);p.querySelectorAll('[name="payload-field"]').forEach(f=>{b.has(f.dataset.key)&&(f.value=b.get(f.dataset.key))})}catch{}y.style.display="none",p.style.display="",a.dataset.mode="parsed",a.textContent="Raw"}return}const s=e.target.closest(".detail-entry-toggle");if(s){const d=parseInt(s.dataset.index);e.shiftKey?(e.preventDefault(),q=!0,chrome.runtime.sendMessage({type:"soloEntry",recordingId:g,index:d},()=>$())):chrome.runtime.sendMessage({type:"toggleEntry",recordingId:g,index:d},()=>$());return}const i=e.target.closest(".detail-del");if(i){const d=parseInt(i.dataset.index);chrome.runtime.sendMessage({type:"deleteEntry",recordingId:g,index:d},()=>{H=-1,$()});return}const r=e.target.closest(".variant-add");if(r){const d=parseInt(r.dataset.index);let p;if(k)try{p=JSON.stringify(k.get())}catch{p=""}else p=(C.querySelector(`.edit-form[data-index="${d}"]`)?.querySelector('[name="body"]')||{}).value||"";chrome.runtime.sendMessage({type:"addVariant",recordingId:g,index:d,name:`variant ${Date.now()%1e3}`,body:p},()=>$());return}const o=e.target.closest(".variant-pick");if(o){const d=parseInt(o.dataset.index);Ge(d);return}const c=e.target.closest(".variant-edit");if(c){const d=c.closest(".variant-tab"),p=d.closest(".variant-bar"),y=parseInt(p.dataset.index),b=parseInt(d.dataset.vi),x=d.childNodes[0].textContent.trim(),f=document.createElement("input");f.className="variant-rename",f.value=x;const I=d.offsetWidth;d.style.width=I+"px",d.innerHTML="",d.appendChild(f),f.size=x.length||1,f.addEventListener("input",()=>{f.size=f.value.length||1,d.style.width="",d.style.minWidth=I+"px"}),f.focus(),f.select();const P=()=>{const L=f.value.trim()||x;chrome.runtime.sendMessage({type:"renameVariant",recordingId:g,index:y,variantIndex:b,name:L},()=>$())};f.addEventListener("keydown",L=>{L.key==="Enter"&&P(),L.key==="Escape"&&$()}),f.addEventListener("blur",P),e.stopPropagation();return}const m=e.target.closest(".variant-del");if(m){const d=m.closest(".variant-bar"),p=parseInt(d.dataset.index),y=parseInt(m.dataset.vi);chrome.runtime.sendMessage({type:"deleteVariant",recordingId:g,index:p,variantIndex:y},()=>$());return}const h=e.target.closest(".variant-tab");if(h){const d=h.closest(".variant-bar"),p=parseInt(d.dataset.index),y=parseInt(h.dataset.vi);chrome.runtime.sendMessage({type:"setActiveVariant",recordingId:g,index:p,variantIndex:y},()=>$());return}const l=e.target.closest(".save");if(l){const d=parseInt(l.dataset.index),p=C.querySelector(`.edit-form[data-index="${d}"]`),y=Pe(p);let b;if(k)try{b=JSON.stringify(k.get())}catch{b=""}else b=(p.querySelector('[name="body"]')||{}).value||"";let x;const f=p.querySelector(".url-parsed");if(f&&f.style.display!=="none"){const L=f.querySelector('[name="url-base"]').value,W=[...f.querySelectorAll('[name="url-param"]')].map(_=>[_.dataset.key,_.value]);x=he(L,W)}else x=p.querySelector('[name="url"]').value;const I=N[d],P={url:x,method:p.querySelector('[name="method"]').value,status:parseInt(p.querySelector('[name="status"]').value)||200,kind:p.querySelector('[name="kind"]').value,delay:parseInt(p.querySelector('[name="delay"]').value)||0,body:b};if(I?.bodyVariants){const L=I.activeVariant||0,j=I.bodyVariants.map((W,_)=>_===L?{...W,body:b}:W);P.bodyVariants=j}y!==null&&(P.payload=y),l.classList.add("saved"),setTimeout(()=>l.classList.remove("saved"),200),chrome.runtime.sendMessage({type:"updateEntry",recordingId:g,index:d,updates:P});return}if(e.target.closest(".cancel")){H=-1,$();return}const v=e.target.closest(".detail-row");if(v&&!e.target.closest(".detail-entry-toggle")){const d=parseInt(v.dataset.index);e.shiftKey?(q=!0,chrome.runtime.sendMessage({type:"soloEntry",recordingId:g,index:d},()=>$())):(H=H===d?-1:d,$())}});fe();ae();U();B();const ie=new URLSearchParams(location.search).get("recording");ie&&chrome.runtime.sendMessage({type:"getState"},e=>{e?.recordings?.some(t=>t.id===ie)&&ve(ie)});setInterval(()=>{ne==="main"?B():(re(),X.classList.contains("recording")&&Ae())},500);
